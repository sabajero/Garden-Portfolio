<!DOCTYPE html>
<!-- Add dark class here dynamically -->
<!-- FIXED: Removed h-full, added dark:bg-black -->
<html lang="en" class="bg-white dark:bg-black">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="images/beetle.png">
    <title>Jerónimo Gutiérrez Balanta</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- NEW: Load p5.js for the Garden -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
    <!-- Add Tailwind dark mode config -->
    <script>
        tailwind.config = {
            darkMode: 'class', // Enable 'class' strategy for dark mode
            theme: {
                extend: {
                    // You can add custom theme settings here if needed
                    colors: {
                        'spring-green': '#00FF7F',
                    }
                }
            }
        }
    </script>
    <style>

        #loading-screen {
        opacity: 1; /* Start fully visible */
        transition: opacity 500ms ease-in-out; /* Define the fade duration here */
    }
        /* NEW: This class will be added by JS to fade out the loader */
        #loading-screen.hidden {
            opacity: 0;
            pointer-events: none; /* Lets you click "through" it while it fades */
        }
        /* --- ADD THIS FOR THE PULSING ANIMATION --- */
            @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.8;
            }
            }

            #loader-icon {
            /* This runs the 'pulse' animation over 1.5s, on repeat */
            animation: pulse 1.5s ease-in-out infinite;
            }
            /* --- END OF NEW CSS --- */

        /* Simple fade-in transition */
        .content-section {
            display: none;
            animation: fadeIn 0.5s;
        }
        .content-section.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Dark mode toggle switch styles */
        .toggle-switch {
            width: 40px;
            height: 22px;
            position: relative;
            display: inline-block;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 22px;
        }
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .toggle-slider {
            background-color: #c388ff; /* Spring Green */
        }
        input:checked + .toggle-slider:before {
            transform: translateX(18px);
        }

        /* NEW: Styles for the p5.js canvas */
        /* UPDATED: Container is now full screen */
        #garden-canvas-container {
            position: relative;
            width: 100%;
            height: 100vh; /* Fill the full viewport height */
            cursor: crosshair;
        }
        #garden-canvas-container canvas {
            display: block;
        }
        /* ... Removed border styles ... */

        

    </style>
</head>
<!-- FIXED: Removed h-full -->
<body class="font-sans antialiased text-gray-900 bg-white dark:bg-black dark:text-gray-200">
    
    <!-- NEW: LOADING SCREEN -->
    <div id="loading-screen" class="fixed top-0 left-0 w-full h-full bg-white dark:bg-black flex items-center justify-center z-[9999]">
        <!-- You can put any loading text or animation here -->
        <img id="loader-icon" src="images/beetle.png" alt="Loading" class="w-10 h-10">
    </div>

    <!-- Main Site Wrapper -->
    <div id="main-wrapper" class="flex flex-col min-h-screen">
        <!-- Header / Navigation -->
        <header class="sticky top-0 bg-white/95 backdrop-blur-sm z-10 dark:bg-black/95">
            <nav class="container mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between h-16">
                <!-- Your Name (now a button, styles matched) -->
                <button id="name-btn" class="text-lg font-medium flex items-center">
                 <img src="images/beetle.png" alt="Beetle Icon" class="w-4 h-4 mr-2"> <!-- Tweak w-6 h-6 (size) and mr-2 (spacing) as needed -->
                    Jerónimo Gutiérrez Balanta
                </button>
                
                <!-- Navigation Buttons -->
                <div class="flex items-center space-x-6">
                    <!-- Standard Nav -->
                    <!-- UPDATED: Added pill styling classes -->
                    <div class="hidden sm:flex items-center space-x-2">
                        <!-- RENAMED: Home to Garden -->
                        <button id="garden-btn" class="text-lg font-medium px-4 py-1.5 rounded-full">Garden</button>
                        <button id="works-btn" class="text-lg font-medium px-4 py-1.5 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800">Works</button>
                        <button id="about-btn" class="text-lg font-medium px-4 py-1.5 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800">About me</button>
                    </div>

                    <!-- REMOVED: View Toggle Button -->

                    <!-- REMOVED: Language Selector -->

                    <!-- Dark Mode Toggle -->
                    <label for="dark-mode-toggle" class="toggle-switch">
                        <input type="checkbox" id="dark-mode-toggle">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </nav>
        </header>

        <!-- UPDATED: Garden Page is now outside <main> and full-screen -->
        <section id="garden-page" class="content-section active fixed top-0 left-0 w-full h-full z-0">
            <!-- This div will hold the p5.js canvas -->
            <div id="garden-canvas-container">
                <!-- p5.js will create and insert a <canvas> element here -->
            </div>
        </section>


        <!-- Main Content Area (for Works, About, Simple) -->
        <!-- UPDATED: Added relative z-5 and backgrounds to appear on top of garden -->
        <main id="main-content" class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 flex-grow relative z-5 bg-white dark:bg-black">

            <!-- "Normal" Portfolio View -->
            <section id="normal-portfolio" class="content-section"> <!-- "active" class removed -->
                
                <!-- NEW: GRID/LIST TOGGLE -->
                <div class="flex items-center justify-end mb-4 space-x-2">
                    <button id="grid-view-btn" class="px-3 py-1 text-sm font-medium rounded-full">
                        Grid
                    </button>
                    <button id="list-view-btn" class="px-3 py-1 text-sm font-medium rounded-full">
                        List
                    </button>
                </div>
    
                <!-- NEW: Tag Filter Container (NOW SHARED) -->
                <div id="tag-filter-container" class="flex flex-wrap gap-2 mb-8">
                    <!-- JS will populate this with tag buttons -->
                </div>

                <!-- This is the container for the GRID -->
                <div id="normal-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- JS will populate this -->
                </div>

                <!-- NEW: CONTAINER FOR THE LIST VIEW -->
                <div id="list-view-container" class="hidden"> <!-- 'hidden' by default -->
                    
                    <!-- REMOVED: simple-tag-filter-container was here -->
                    
                    <!-- This is the two-column layout from the "simple" view -->
                    <div class="flex flex-col md:flex-row gap-8">
                        <!-- Left Column: Project List -->
                        <div class="w-full md:w-1/3 lg:w-1/3">
                            <ul id="simple-project-list" class="space-y-3">
                                <!-- JS will populate this -->
                            </ul>
                        </div>
                        <!-- Right Column: Project PICTURES -->
                        <div id="simple-project-image-container" class="w-full md:w-2/3 lg:w-3/4 sticky top-24 self-start h-[calc(100vh-6rem)]">
                            <!-- JS will populate this -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- "About" Page View -->
            <section id="about-page" class="content-section">
                <div class="max-w-3xl mx-auto">
                    <img src="images/thumbnails/jero.png" class="space-">
                    <div class="space-y-4 text-lg text-gray-700 dark:text-gray-300">
                
                        <p>I am a young visual artist that lives and works in Bremen, Germany. I've focused my work towards topics such as the relationships between body and city, family archives, disappearance  and illness, expressing these ideas through traditional techniques like painting, drawing and performance as well as digital and other medium techniques like animation, soundscape, and research-creation. The body in dispute, as a political and poetic issue, is the central axis of my work. Due to the nature of my bachelor degree, I also have a strong background in pedagogy, aesthetics and art history.</p>
                        <p>As a graphic designer, I have specialized in illustration, visual thinking, and product design, working closely with various companies, universities, and regional institutions in interdisciplinary teams and projects. These projects encompass topics such as university continuing education, non-profit training programs with vulnerable communities, and government projects for women's equality and welfare.

                            In my free time, as a personal note, I am an amateur musician. I studied three years of music in high school with an emphasis on piano, and I greatly enjoy trail running.
                        <h4> Education <h4>
                       <p>2024 - Now Digital Media Master, HfK Bremen, Germany<p> 
                        <p>2016-2022 Bachelor in Visual Arts, Universidad del Valle, Cali, Colombia<p>
                        <p>2014-2016 Technical School Certificate, Electronics, SENA<p>
                        ​<p>2011-2013 Musical Juvenile Studies, “Plan Pentagrama”, Universidad del Valle</p>

                        <p>​Contact me :)<p>
                        <p>jeguba1999@gmail.com<p>
                        <p>(+57) 3004085202 - (+49)1630819959 <p>
                        <p>Ig: @sabajero<p>
                    </div>
                </div>
            </section>

            <!-- REMOVED: "Simplified" Portfolio View Section -->

        </main>

        <!-- Footer -->
        <!-- FIXED: Added bg-white dark:bg-black to ensure footer has a background in both modes -->
        <!-- UPDATED: Footer should also be on top of the garden page -->
        <footer class="bg-white dark:bg-black border-t border-gray-200 dark:border-gray-800 mt-16 relative z-5">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-6 text-left text-sm text-gray-500 dark:text-gray-400">
                &copy; <span id="current-year"></span> Jerónimo Gutiérrez Balanta. All rights reserved. If you want to use, share something or have questions just send me an email :) 
            </div>
        </footer>
    </div>

    <!-- DATA DATA DAT
     Jerarquía:
         Design
             Research
                 Personal
                     Work
                         On-going
         #Drawing
             #Publication
                 #Digital
                     #Sound
                         #Performance
                               -->
    <script>
        const portfolioData = [
            // Your existing projects
            { id: 1, title: "Windcatchers", year: 2025, type: "Research", description: "A project about machines, displays and wind.", thumbnail: "images/thumbnails/windcatchers_1.jpg", tags: ["Design"] },
            { id: 2, title: "Corp Bully", year: 2025, type: "Video Game", description: "Part of my outsourcing research.", thumbnail: "images/thumbnails/corp.png", tags: ["Design"] },
            { id: 3, title: "How to shit on your company", year: 2024, type: "User Manual", description: "Client photoshoot.", thumbnail: "images/thumbnails/shit.jpg", tags: ["Design"] },
            { 
                id: 4.2, 
                title: "Synthetic Chordata", 
                year: 2025, 
                type: "Zine", 
                description: "The following audio essay is an exploration and reflection on the life of my great aunt Aura, who worked in the Merino coffee factory in the 60s. Starting from her oral tradition and stories around coffee, I carry out an essay that crosses approaches from sound philosophy to talk about silencing, the defiance of family narratives, and sound in my artistic practice as another way of making memory. ", 
                thumbnail: "images/thumbnails/chordata.jpg", 
                tags: ["Design","Publication",] 
            },
            { 
                id: 4, 
                title: "Aura Coffee Company", 
                year: 2025, 
                type: "Sound Essay", // 
                description: "The following audio essay is an exploration and reflection on the life of my great aunt Aura, who worked in the Merino coffee factory in the 60s. Starting from her oral tradition and stories around coffee, I carry out an essay that crosses approaches from sound philosophy to talk about silencing, the defiance of family narratives, and sound in my artistic practice as another way of making memory. ", 
                thumbnail: "images/thumbnails/aura.jpg", 
                tags: ["Sound", "Essay", "Research"] 
            },
            { 
                id: 4.5, 
                title: "Internship: GICAEA", 
                year: 2021, 
                type: "Education", // 
                description: "The following audio essay is an exploration and reflection on the life of my great aunt Aura, who worked in the Merino coffee factory in the 60s. Starting from her oral tradition and stories around coffee, I carry out an essay that crosses approaches from sound philosophy to talk about silencing, the defiance of family narratives, and sound in my artistic practice as another way of making memory. ", 
                thumbnail: "images/thumbnails/gicaea.jpg", 
                tags: ["Education", "Printmaking", "Research"] 
            },
            {
                id: 5,
                title: "Pandémica",
                year: 2022,
                type: "Research-Creation",
                description: "This Meritorious Degree Work, conducted at Universidad del Valle, comprises a monograph and artistic creation grounded in research-creation methodology, aimed at reflecting on the changes brought by the Covid-19 pandemic to daily life in Cali and Buga through a virtual art book.",
                thumbnail: "images/thumbnails/pandemica.jpeg",
                tags: ["Research","Drawing"] 
            },
            {
                id: 6,
                title: "Que no le pase comadre!",
                year: 2022,
                type: "Comic",
                description: "Design, conceptualization and illustration for this short comic that emerged from the research project \"Characterization of the health status of Women in Buenaventura and Guapi,\" supported by the Ministry of Science and Technology and executed by the \"Observatorio para la Equidad de las Mujeres (OEM)\" between 2021 and 2022.",
                thumbnail: "images/thumbnails/comadre.png",
                tags: ["Comic","Work"] 
            },
            {
                id: 6.1,
                title: "Ahora sin cielo abierto",
                year: 2021,
                type: "Painting",
                description: "Now without an open sky is a project that seeks to illustrate the feelings, thoughts and experiences of 10 young university students in the confinement caused by the Covid 19 pandemic in Cali. Each illustration was made from the dialogue with the participants and what they considered significant to be illustrated. The result of this exercise are ten watercolors that speak of the city and the experience of confinement from an intimate point of view.",
                thumbnail: "images/thumbnails/cielo.jpg",
                tags: ["Research"] 
            },
            {
                id: 7,
                title: "Noctambulas Permanentes",
                year: 2022,
                type: "Muralism",
                description: "\"Permanent Night Owls\" project originated as a response to the Covid-19 lockdown, initially conceived as a home muralism proposal.",
                thumbnail: "images/thumbnails/bichos.jpeg",
                tags: ["Drawing",] 
            },
            {
                id: 8,
                title: "Aleteo Shakuhachi",
                year: 2020, // Used 2020 from "2019 - 2020"
                type: "Artistic/Educational Project",
                description: "Aleteo Shakuhachi Project was an artistic / educational project conceived along two friends of mine, our objective was to teach, build and explore the possibilities of the Japanese flute \"Shakuhachi\" outside the musical or meditation context.",
                thumbnail: "images/thumbnails/shaku.jpg",
                tags: ["Education","Design"] 
            },
            {
                id: 9,
                title: "Interlude to practice the useless",
                year: 2019,
                type: "Performance",
                description: "Performance action took place during the 2019 Manizales International Contemporary Art Festival (FIAC), organized by the University of Caldas. It involved walking very slowly for an hour along one of the city's busiest streets while playing the Japanese Shakuhachi flute. This action challenged the city's dynamics and conventional notions of street usage.",
                thumbnail: "images/thumbnails/interlude.jpg",
                tags: ["Performance",] 
            },
            {
                id: 10,
                title: "El toro más fuerte",
                year: 2019,
                type: "Imagery",
                description: "\"The Strongest Bull\" is a project that from my personal experience of familial disappearance to explore collective narratives of disappearance phenomena in Colombia in the 80's, utilizing imagery as a tool for spectator reflection.",
                thumbnail: "images/thumbnails/toro.jpeg",
                tags: ["Research","Animation"] 
            },
            {
                id: 11,
                title: "Letras Ilustradas: Bello 2019",
                year: 2019,
                type: "Illustration",
                description: "Open call to artists to participate collectively in the creation of illustrations for the book \"Escondidijo\", I was involded as one of the many artist that illustrated for this book.",
                thumbnail: "images/thumbnails/letras.jpg",
                tags: ["Illustration"] 
            },
            {
                id: 12,
                title: "Paisaje en Falso",
                year: 2017,
                type: "Sound Recording",
                description: "\"False Landscape\" was a project undertaken in 2017, based on recordings captured in Cali, Colombia",
                thumbnail: "images/thumbnails/falso.jpg",
                tags: ["Sound"] 
            },
                        //DESIGN
            {
                id: 13,
                title: "Capricci Club: Candela & Quimera",
                year: 2020,
                type: "Graphic Design",
                description: "Capricci Club is a colombian feminist brand that offers hair care products, with them I had the opportunity to create some of the design of labels for hair care products, design of packaging boxes and branding (Logos, color palettes, visual identity).",
                thumbnail: "images/thumbnails/candela.jpg",
                tags: ["Work"] 
            },
            {
                id: 14,
                title: "Capricci Club: Frida & Kahlo",
                year: 2022,
                type: "Graphic Design",
                description: "Capricci Club is a colombian feminist brand that offers hair care products, with them I had the opportunity to create some of the design of labels for hair care products, design of packaging boxes and branding (Logos, color palettes, visual identity).",
                thumbnail: "images/thumbnails/capricci.jpg",
                tags: ["Work"] 
            },
            {
                id: 15,
                title: "Visual Thinking Webinars: Javeriana",
                year: 2020,
                type: "Graphic Design",
                description: "Visual Thinking was for more than a year my job, translating complex information to fun memorable drawings in real time ;)",
                thumbnail: "images/thumbnails/visual1.png",
                tags: ["Work","Visual Thinking"] 
            },
            {
                id: 16,
                title: "Visual Thinking: OEM-Oxfam",
                year: 2022,
                type: "Graphic Design",
                description: "Live visual thinking for private event",
                thumbnail: "images/thumbnails/oxfam.png",
                tags: ["Work","Visual Thinking"] 
            },
            {
                id: 17,
                title: "Didactic Graphic Material - AMUCC",
                year: 2021,
                type: "Graphic Design",
                description: "Graphic and didactic material for the project Factors that influence the empowerment of women coffee growers in Cauca associated with AMUCC, Javeriana Cali University, WWB Colombia Foundation, Tecnicafé, AMUCC.",
                thumbnail: "images/thumbnails/amucc.png",
                tags: ["Work"] 
            },
            {
                id: 18,
                title: "CVC, Univalle: Visual Thinking ",
                year: 2021,
                type: "Graphic Design",
                description: "Visual Reporting or Visual Thinking of 2 workshops from the Environmental Passives project in the communities of Triana and Zacarías, in the Colombian Pacific,ana Cali University, WWB Colombia Foundation, Tecnicafé, AMUCC.",
                thumbnail: "images/thumbnails/zacarias.jpg",
                tags: ["Work","Visual Thinking"] 
            },
        ];
        // Sorte Portfolio Data
        const sortedPortfolioData = [...portfolioData].sort((a, b) => b.year - a.year);

        // --- APPLICATION STATE ---
        // UPDATED: Removed isSimple, added worksView
        const state = {
            worksView: 'grid',// NEW: Can be 'grid' or 'list',
            currentView: 'garden-page', // 'garden-page', 'normal-portfolio' or 'about-page'
            selectedSimpleProject: portfolioData.length > 0 ? portfolioData[0].id : null, 
            currentTag: 'all' 
        };

        // NEW: p5.js Sketch instance holder
        let gardenSketch = null;

        // --- DOM ELEMENTS ---
        const mainContent = document.getElementById('main-content');
        const sections = document.querySelectorAll('.content-section');
        const nameBtn = document.getElementById('name-btn'); 
        const gardenBtn = document.getElementById('garden-btn'); 
        const worksBtn = document.getElementById('works-btn');
        const aboutBtn = document.getElementById('about-btn');
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        
        // NEW: "Works" page view-toggle elements
        const gridViewBtn = document.getElementById('grid-view-btn');
        const listViewBtn = document.getElementById('list-view-btn');
        const gridViewContainer = document.getElementById('normal-grid'); // This ID already existed
        const listViewContainer = document.getElementById('list-view-container'); // We added this ID in the HTML
        
        const footer = document.querySelector('footer');

        // Simple Portfolio Elements (now part of "Works")
        const simpleProjectList = document.getElementById('simple-project-list');
        const simpleProjectImageContainer = document.getElementById('simple-project-image-container');
        // REMOVED: const simpleTagFilterContainer = document.getElementById('simple-tag-filter-container'); 

        // Normal Portfolio Elements (now just the grid)
        const normalGrid = document.getElementById('normal-grid');
        const tagFilterContainer = document.getElementById('tag-filter-container'); 

        // --- RENDER FUNCTIONS ---
        
        /**
         * Main render function to update the view based on the current state
         */
        // UPDATED: This is the new, cleaned-up render() function
        function render() {  
            // Toggle active state for page navigation buttons
            // SIMPLIFIED: Removed '!state.isSimple' checks
            const isGardenActive = state.currentView === 'garden-page';
            gardenBtn.classList.toggle('bg-spring-green', isGardenActive);
            gardenBtn.classList.toggle('text-black', isGardenActive);
            gardenBtn.classList.toggle('text-gray-700', !isGardenActive);
            gardenBtn.classList.toggle('dark:text-gray-400', !isGardenActive);
            gardenBtn.classList.toggle('hover:bg-gray-100', !isGardenActive);
            gardenBtn.classList.toggle('dark:hover:bg-gray-800', !isGardenActive);

            const isWorksActive = state.currentView === 'normal-portfolio';
            worksBtn.classList.toggle('bg-spring-green', isWorksActive);
            worksBtn.classList.toggle('text-black', isWorksActive);
            worksBtn.classList.toggle('text-gray-700', !isWorksActive);
            worksBtn.classList.toggle('dark:text-gray-400', !isWorksActive);
            worksBtn.classList.toggle('hover:bg-gray-100', !isWorksActive);
            worksBtn.classList.toggle('dark:hover:bg-gray-800', !isWorksActive);
            
            const isAboutActive = state.currentView === 'about-page';
            aboutBtn.classList.toggle('bg-spring-green', isAboutActive);
            aboutBtn.classList.toggle('text-black', isAboutActive);
            aboutBtn.classList.toggle('text-gray-700', !isAboutActive);
            aboutBtn.classList.toggle('dark:text-gray-400', !isAboutActive);
            aboutBtn.classList.toggle('hover:bg-gray-100', !isAboutActive);
            aboutBtn.classList.toggle('dark:hover:bg-gray-800', !isAboutActive);

            // Show/Hide page sections
            sections.forEach(section => {
                section.classList.toggle('active', section.id === state.currentView);
            });

            // NEW: Hide main container and footer when garden is active
            if (isGardenActive) {
                mainContent.style.display = 'none';
                footer.style.display = 'none';
            } else {
                mainContent.style.display = 'block';
                footer.style.display = 'block';
            }

            // Populate content for the active view
            if (state.currentView === 'normal-portfolio') {
                renderWorksPage(); // RENAMED this function call
            }
            // "About" page is static HTML, so no render function needed
            
            // NEW: Control p5.js sketch loop
            if (gardenSketch) {
                if (state.currentView === 'garden-page') {
                    if (gardenSketch.isLooping && !gardenSketch.isLooping()) {
                        gardenSketch.loop(); 
                    }
                } else {
                    if (gardenSketch.isLooping && gardenSketch.isLooping()) {
                        gardenSketch.noLoop(); 
                    }
                }
            }
        }

        /**
         * NEW: Refactored function to render tag filters
         * @param {HTMLElement} container - The container element to populate
         * @param {boolean} isGrey - Whether to use the grey-text style
         */
        function renderTagFilters(container, isGrey = false) {
            container.innerHTML = ''; // Clear tags
            
            const allTags = new Set();
            // FIXED: Check if project.tags exists before iterating
            portfolioData.forEach(p => {
                if (p.tags) {
                    p.tags.forEach(tag => allTags.add(tag))
                }
            });
            const sortedTags = [...allTags].sort();

            // --- Button Styling ---
            const activeClass = isGrey 
                ? 'bg-gray-300 dark:bg-gray-600 text-black dark:text-white' 
                : 'bg-spring-green text-black';
            
            const inactiveClass = isGrey
                ? 'bg-gray-100 dark:bg-gray-800 text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-700'
                : 'bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700';

            // Create "All" button
            const allBtn = document.createElement('button');
            allBtn.textContent = 'All'; // UPDATED: Hardcoded text
            allBtn.className = `px-3 py-1 text-sm font-medium rounded-full ${state.currentTag === 'all' ? activeClass : inactiveClass}`;
            allBtn.onclick = () => {
                state.currentTag = 'all';
                render(); 
            };
            container.appendChild(allBtn);

            // Create buttons for each tag
            sortedTags.forEach(tag => {
                const tagBtn = document.createElement('button');
                tagBtn.textContent = tag;
                tagBtn.className = `px-3 py-1 text-sm font-medium rounded-full ${state.currentTag === tag ? activeClass : inactiveClass}`;
                tagBtn.onclick = () => {
                    state.currentTag = tag;
                    render(); 
                };
                container.appendChild(tagBtn);
            });
        }

        /**
         * NEW: Main controller for the "Works" page
         * This function decides whether to show the Grid or List.
         */
        // UPDATED: Logic moved around
        function renderWorksPage() {
            // 1. Update active state of toggle buttons
            const gridActiveClass = 'bg-spring-green text-black';
            const gridInactiveClass = 'bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700';
            const listActiveClass = 'bg-spring-green text-black';
            const listInactiveClass = 'bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700';

            gridViewBtn.className = `px-3 py-1 text-sm font-medium rounded-full ${state.worksView === 'grid' ? gridActiveClass : gridInactiveClass}`;
            listViewBtn.className = `px-3 py-1 text-sm font-medium rounded-full ${state.worksView === 'list' ? listActiveClass : listInactiveClass}`;

            // 2. Render the SHARED tag filter
            // Style depends on the current view (list is grey, grid is green)
            const isListMode = state.worksView === 'list';
            renderTagFilters(tagFilterContainer, isListMode);

            // 3. Show/Hide the correct view container and render its content
            if (state.worksView === 'grid') {
                gridViewContainer.style.display = 'grid'; // 'grid' not 'block'
                listViewContainer.style.display = 'none';
                renderGridProjects();
            } else {
                gridViewContainer.style.display = 'none';
                listViewContainer.style.display = 'block';
                renderListProjects();
            }
        }

        /**
         * NEW: Helper function to render the project grid
         * (This is the logic from your old 'renderNormalPortfolio')
         */
        function renderGridProjects() {
            normalGrid.innerHTML = ''; // Clear existing grid
            
            const sortedProjects = sortedPortfolioData; 
            const filteredProjects = state.currentTag === 'all'
                ? sortedProjects
                : sortedProjects.filter(p => p.tags && p.tags.includes(state.currentTag));

            filteredProjects.forEach(project => {
                const item = document.createElement('div');
                item.className = 'space-y-2'; 
                item.innerHTML = `
                    <img src="${project.thumbnail}" alt="${project.title}" class="w-full h-64 object-cover border border-gray-200 dark:border-gray-700 dark:opacity-80">
                    <div>
                        <h3 class="text-lg font-bold">${project.title}</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400">${project.year} &ndash; ${project.type}</p>
                    </div>
                `;
                normalGrid.appendChild(item);
            });
        }

        /**
         * NEW: Helper function to render the project list
         * (This is the logic from your old 'renderSimplePortfolio')
         */
        function renderListProjects() {
            // 1. Populate project list
            simpleProjectList.innerHTML = ''; // Clear list
            
            const sortedProjects = sortedPortfolioData; 
            const filteredProjects = state.currentTag === 'all'
                ? sortedProjects
                : sortedProjects.filter(p => p.tags && p.tags.includes(state.currentTag)); 
            
            if (filteredProjects.length === 0) {
                simpleProjectList.innerHTML = `<li class="text-gray-500">No projects to display.</li>`;
                simpleProjectImageContainer.innerHTML = ''; // Clear image
                return;
            }

            filteredProjects.forEach(project => {
                const li = document.createElement('li');
                const button = document.createElement('button');
                button.className = `w-full text-left ${project.id === state.selectedSimpleProject ? 'font-bold text-spring-green' : 'hover:text-gray-500 dark:hover:text-gray-400'}`;
                button.innerHTML = `
                    <span class="block">${project.title}</span>
                    <span class="block text-xs text-gray-500 dark:text-gray-400">${project.year} - ${project.type}</span>
                `;
                button.onmouseenter = () => {
                    state.selectedSimpleProject = project.id;
                    renderListProjects(); // Only need to re-render this part
                };
                li.appendChild(button);
                simpleProjectList.appendChild(li);
            });

            // 2. Populate selected project details
            let selectedProject = filteredProjects.find(p => p.id === state.selectedSimpleProject);

            if (!selectedProject && filteredProjects.length > 0) {
                state.selectedSimpleProject = filteredProjects[0].id;
                selectedProject = filteredProjects[0];
            }
            
            if (selectedProject) {
                simpleProjectImageContainer.innerHTML = ''; // Clear image
                const img = document.createElement('img');
                img.src = selectedProject.thumbnail; 
                img.alt = `${selectedProject.title} image`;
                img.className = 'w-full max-h-[75vh] object-cover border border-gray-200 dark:border-gray-700 dark:opacity-80'; 
                simpleProjectImageContainer.appendChild(img);
            } else {
                simpleProjectImageContainer.innerHTML = '';
            }
        }

        // --- REMOVED: TRANSLATION FUNCTION ---

        // --- EVENT LISTENERS ---
        // UPDATED: All listeners are now cleaned up
        nameBtn.addEventListener('click', () => { 
            state.currentView = 'garden-page';
            state.currentTag = 'all'; // Reset tag on page change
            render();
        });

        gardenBtn.addEventListener('click', () => { 
            state.currentView = 'garden-page';
            state.currentTag = 'all'; // Reset tag on page change
            render();
        });

        worksBtn.addEventListener('click', () => {
            state.currentView = 'normal-portfolio';
            state.currentTag = 'all'; // Reset tag on page change
            render();
        });

        aboutBtn.addEventListener('click', () => {
            state.currentView = 'about-page';
            state.currentTag = 'all'; // Reset tag on page change
            render();
        });

       gridViewBtn.addEventListener('click', () => {
            state.worksView = 'grid';
            state.currentTag = 'all'; // Reset tags when switching view
            render();
        });

        listViewBtn.addEventListener('click', () => {
            state.worksView = 'list';
            state.currentTag = 'all'; // Reset tags when switching view
            render();
        });

        // --- REMOVED: LANGUAGE SELECTOR ---

        // --- DARK MODE ---
        const htmlElement = document.documentElement;

        // Check for saved theme in localStorage
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            htmlElement.classList.add('dark');
            darkModeToggle.checked = true;
        } else {
            htmlElement.classList.remove('dark');
            darkModeToggle.checked = false;
        }

        // Listen for toggle change
        darkModeToggle.addEventListener('change', () => {
            if (darkModeToggle.checked) {
                htmlElement.classList.add('dark');
                localStorage.theme = 'dark';
            } else {
                htmlElement.classList.remove('dark');
                localStorage.theme = 'light';
            }
        });

        // --- FOOTER YEAR ---
        document.getElementById('current-year').textContent = new Date().getFullYear();

        // --- INITIAL RENDER ---
        // Run the render function on page load
        render();
        // REMOVED: translatePage();


        // --- NEW: p5.js GARDEN SKETCH ---
        
        // Wrap p5 sketch initialization in DOMContentLoaded listener
        document.addEventListener('DOMContentLoaded', () => {
            // This class defines a "Plant" in our garden
            const imageDisplayDuration = 40; // 2 seconds (at 60fps)
            const loadingScreen = document.getElementById('loading-screen');
            
            let projectImageCache = {};
            let currentHoverImage = null; // Holds the single image being shown
            let hoverImageTimer = 0;      // Timer for switching the image
    
            /**
             * Draws an image with object-cover behavior
             */

              // --- MODIFIED LOADING SCREEN LOGIC ---
                 setTimeout(() => {
                     if (loadingScreen) {
                         void loadingScreen.offsetWidth; 
                         loadingScreen.classList.add('hidden');
                     }
                 }, 700); 
                 
            function drawCroppedImage(p, img, x, y, w, h) {
                const imgRatio = img.width / img.height;
                const targetRatio = w / h; 

                let sx = 0, sy = 0, sWidth = img.width, sHeight = img.height;

                if (imgRatio > targetRatio) {
                    sWidth = img.height * targetRatio;
                    sx = (img.width - sWidth) / 2;
                } else if (imgRatio < targetRatio) {
                    sHeight = img.width / targetRatio;
                    sy = (img.height - sHeight) / 2;
                }
                p.image(img, x, y, w, h, sx, sy, sWidth, sHeight);
            }
            
            class Plant {
                constructor(p, project, x, y, h) {
                    this.p = p; // The p5.js instance
                    this.project = project;
                    this.baseX = x;
                    this.baseY = y;
                    this.height = h;
                    this.flowerSize = 20;
                    this.waveOffset = p.random(1000); 
                    this.isHovered = false;
                    this.bendOffset = p.random(-40, 40);
                }

                // Check if the mouse is near the flower
                checkHover() {
                    const wave = this.p.sin(this.p.frameCount * 0.02 + this.waveOffset) * 10;
                    const flowerX = this.baseX + wave;
                    const flowerY = this.baseY - this.height;

                    const d = this.p.dist(this.p.mouseX, this.p.mouseY, flowerX, flowerY);
                    this.isHovered = (d < 150); 
                }

                // Handle the click event
                // UPDATED: This is the new click() logic
                click() {
                    if (this.isHovered) {
                        // --- NEW CLICK LOGIC ---
                        state.currentView = 'normal-portfolio'; // Go to "Works" page
                        state.worksView = 'list';               // Set view to "List"
                        state.selectedSimpleProject = this.project.id; // Select this project
                        state.currentTag = 'all'; // <--- ADD THIS LINE
                        render(); // Tell the main page to update
                        return true;
                    }
                }

                // Draw the plant
                display(isDark) {
                    const p = this.p;

                    const stemColor = isDark ? 100 : 150; 
                    const flowerColor = isDark ? [150, 150, 150] : [100, 100, 100]; 
                    const hoverColor = [0, 255, 127]; 
                    const textColor = isDark ? 255 : 0;
                    const textBg = isDark ? 0 : 255;

                    const wave = this.p.sin(this.p.frameCount * 0.02 + this.waveOffset) * 35; 
                    const flowerX = this.baseX + wave;
                    const flowerY = this.baseY - this.height;

                    p.noFill();
                    p.stroke(stemColor);
                    p.strokeWeight(2);
                    p.bezier(
                        this.baseX, this.baseY,                       
                        this.baseX + this.bendOffset, this.baseY - this.height * 0.33,   
                        flowerX - this.bendOffset, this.baseY - this.height * 0.66,   
                        flowerX, flowerY                        
                    );

                    if (this.isHovered) {
                        const lineAlpha = 100; 
                        p.stroke(hoverColor[0], hoverColor[1], hoverColor[2], lineAlpha);
                        p.strokeWeight(3); 
                        p.line(p.mouseX, p.mouseY, flowerX, flowerY);
                    }

                    p.noStroke();
                    
                    const blurAmount = 8;

                    if (this.isHovered) {
                        p.drawingContext.shadowBlur = blurAmount;
                        p.drawingContext.shadowColor = `rgb(${hoverColor[0]}, ${hoverColor[1]}, ${hoverColor[2]})`;
                        p.fill(hoverColor);
                    } else {
                        p.drawingContext.shadowBlur = blurAmount;
                        p.drawingContext.shadowColor = `rgb(${flowerColor[0]}, ${flowerColor[1]}, ${flowerColor[2]})`;
                        p.fill(flowerColor[0], flowerColor[1], flowerColor[2]);
                    }
                    p.ellipse(flowerX, flowerY, this.flowerSize, this.flowerSize);

                    p.drawingContext.shadowBlur = 0;

                    if (this.isHovered) {
                        p.fill(textBg);
                        p.stroke(textColor);
                        p.strokeWeight(1);
                        const textW = p.textWidth(this.project.title) + 10;
                        p.rect(flowerX + 15, flowerY - 10, textW, 20);
                        
                        p.noStroke();
                        p.fill(textColor);
                        p.textAlign(p.LEFT, p.CENTER);
                        p.textSize(12);
                        p.text(this.project.title, flowerX + 20, flowerY);
                    }
                }
            }

            gardenSketch = new p5((p) => {
                let plants = [];
                let canvasContainer;
                let isDark = false;

                p.preload = () => {
                    for (let project of portfolioData) {
                        if (project.thumbnail && project.thumbnail.trim() !== "") {
                            projectImageCache[project.id] = p.loadImage(project.thumbnail);
                        }
                    }
                };

                p.setup = () => {
                    canvasContainer = p.select('#garden-canvas-container');
                    const w = p.windowWidth;
                    const h = p.windowHeight;
                    const canvas = p.createCanvas(w, h);
                    canvas.parent(canvasContainer); // Attach canvas to the container
                    
                    isDark = document.documentElement.classList.contains('dark');

                    const plantCount = portfolioData.length;
                    for (let i = 0; i < plantCount; i++) {
                        const project = portfolioData[i];
                        const x = p.map(i, 0, plantCount - 1, w * 0.1, w * 0.9); 
                        const y = h; 
                        const plantHeight = p.random(h * 0.3, h * 0.7); 
                        plants.push(new Plant(p, project, x, y, plantHeight));
                    }
                    
                    p.noLoop(); 
                    render();
                };

                p.draw = () => {
                    isDark = document.documentElement.classList.contains('dark');
                    p.background(isDark ? 0 : 255); 

                    let hoveredProjectsList = []; 
                    
                    for (let plant of plants) {
                        plant.checkHover(); 
                        if (plant.isHovered) {
                            hoveredProjectsList.push(plant.project);
                        }
                        plant.display(isDark); 
                    }

                    if (hoveredProjectsList.length > 0) {
                        hoverImageTimer++; 

                        if (hoverImageTimer > imageDisplayDuration || !currentHoverImage) {
                            hoverImageTimer = 0; 

                            const randomProject = hoveredProjectsList[Math.floor(Math.random() * hoveredProjectsList.length)];

                            if (randomProject && projectImageCache[randomProject.id]) {
                                currentHoverImage = projectImageCache[randomProject.id];
                            }
                        }

                        const imgSize = 50;
                        p.noStroke(); 
                        if (currentHoverImage && currentHoverImage.width > 0) {
                            drawCroppedImage(p, currentHoverImage, p.mouseX + 0, p.mouseY + -50, imgSize, imgSize);
                        }

                    } else {
                        currentHoverImage = null;
                        hoverImageTimer = 0;
                    }
                };
                        
                p.mouseClicked = () => {
                    for (let plant of plants) {
                        if (plant.click()) {
                            break; 
                        }
                    }
                };

                p.windowResized = () => {
                    const w = p.windowWidth;
                    const h = p.windowHeight;
                    p.resizeCanvas(w, h);
                    
                    const plantCount = plants.length;
                    for (let i = 0; i < plantCount; i++) {
                        const plant = plants[i];
                        plant.baseX = p.map(i, 0, plantCount - 1, w * 0.1, w * 0.9);
                        plant.baseY = h;
                    }
                };

            }); // End of p5.js sketch
        }); // End of DOMContentLoaded listener

    </script>
</body>
</html>
